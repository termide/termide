# Текстовый редактор

Панель текстового редактора предоставляет функциональный редактор для работы с текстовыми файлами с поддержкой подсветки синтаксиса для различных языков программирования.

## Основные возможности

- **Подсветка синтаксиса**: Автоматическая подсветка для популярных языков программирования (Rust, Python, JavaScript, C/C++, Go и др.)
- **Визуализация Git Diff**: Визуализация изменений в реальном времени по сравнению с HEAD с цветовой кодировкой номеров строк (зелёный для добавленных, жёлтый для изменённых, красный для удалённых строк), маркеры удалений показывают количество удалённых строк
- **Поиск и замена**: Поиск по тексту с поддержкой регистрозависимости и замена найденных совпадений
- **История изменений**: Отмена (Undo) и повтор (Redo) действий
- **Буфер обмена**: Копирование, вырезание и вставка через системный буфер обмена
- **Автоматическое сохранение**: Запрос на сохранение при закрытии файла с несохранёнными изменениями

## Навигация

| Комбинация        | Действие                                   |
|-------------------|--------------------------------------------|
| `↑` / `↓`         | Перемещение курсора вверх/вниз             |
| `←` / `→`         | Перемещение курсора влево/вправо           |
| `Home`            | Перейти в начало строки                    |
| `End`             | Перейти в конец строки                     |
| `PageUp` / `PageDown` | Прокрутка на одну страницу             |
| `Ctrl+Home`       | Перейти в начало документа                 |
| `Ctrl+End`        | Перейти в конец документа                  |

## Редактирование

| Комбинация        | Действие                                   |
|-------------------|--------------------------------------------|
| `Ctrl+S`          | Сохранить файл                             |
| `Ctrl+Z`          | Отменить последнее действие (Undo)         |
| `Ctrl+Y`          | Повторить отменённое действие (Redo)       |
| `Ctrl+D`          | Дублировать текущую строку или выделение   |
| `Backspace`       | Удалить символ слева от курсора            |
| `Delete`          | Удалить символ справа от курсора           |
| `Enter`           | Вставить новую строку                      |
| `Tab`             | Вставить отступ (настраиваемый, по умолчанию 4) |

## Поиск и замена

### Интерактивный модал поиска (Ctrl+F)

Нажмите `Ctrl+F` для открытия интерактивного модала поиска с живым предпросмотром:

| Комбинация        | Действие                                   |
|-------------------|--------------------------------------------|
| `Ctrl+F`          | Открыть модал поиска                       |
| Ввод текста       | Поиск обновляется при вводе                |
| `Tab`             | Перейти к следующему совпадению            |
| `Shift+Tab`       | Перейти к предыдущему совпадению           |
| `F3`              | Перейти к следующему совпадению            |
| `Shift+F3`        | Перейти к предыдущему совпадению           |
| `Enter`           | Закрыть модал с выделенным совпадением     |
| `Escape`          | Закрыть модал поиска                       |
| Клик мыши         | Нажать кнопки навигации или `[X]` для закрытия |

**Возможности:**
- Живой предпросмотр поиска при вводе
- Счётчик совпадений (например, "3 из 12")
- Кнопки навигации: ◄ Назад, Вперёд ►
- Кнопка `[X]` для закрытия модала
- Запрос поиска сохраняется при закрытии модала

**Поведение поиска вне модала:**
- `F3` / `Shift+F3` - Навигация по совпадениям при закрытом модале
- `Tab` / `Shift+Tab` - Навигация по совпадениям когда поиск активен
- Любая клавиша навигации/редактирования - Деактивирует режим поиска
- Повторное открытие через `F3` восстанавливает последний запрос

### Интерактивный модал замены (Ctrl+H)

Нажмите `Ctrl+H` для открытия интерактивного модала замены с двумя полями ввода:

| Комбинация        | Действие                                   |
|-------------------|--------------------------------------------|
| `Ctrl+H`          | Открыть модал замены                       |
| Ввод в поле Найти | Поиск обновляется при вводе                |
| `Tab`             | След. совпадение (в Найти) или переход в поле Заменить |
| `Shift+Tab`       | Пред. совпадение (в Найти) или переход в поле Найти |
| `Up` / `Down`     | Навигация между полями Найти и Заменить    |
| `F3`              | Перейти к следующему совпадению            |
| `Shift+F3`        | Перейти к предыдущему совпадению           |
| `Enter`           | Заменить текущее и перейти к следующему    |
| `Escape`          | Закрыть модал замены                       |
| Клик мыши         | Нажать кнопки (Заменить, Всё, Назад, Вперёд) или `[X]` |

**Возможности:**
- Два поля ввода: Найти и Заменить
- Живой предпросмотр поиска при вводе в поле Найти
- Счётчик совпадений (например, "3 из 12")
- Четыре кнопки: Заменить, Всё, ◄ Назад, Вперёд ►
- Кнопка `[X]` для закрытия модала
- Оба текста (найти и заменить) сохраняются при закрытии модала

**Действия кнопок замены:**
- **Заменить** (`Ctrl+R`) - Заменить текущее совпадение и перейти к следующему
- **Всё** (`Ctrl+Alt+R`) - Заменить все совпадения, показать количество и закрыть модал
- **◄ Назад** - Перейти к предыдущему совпадению
- **Вперёд ►** - Перейти к следующему совпадению

**Обратная связь при замене всех:**
- После использования "Заменить всё" в статусной строке показывается количество замен
- Пример: "Replaced 5 occurrences"

## Буфер обмена

| Комбинация        | Действие                                   |
|-------------------|--------------------------------------------|
| `Ctrl+C`          | Копировать выделенный текст                |
| `Ctrl+X`          | Вырезать выделенный текст                  |
| `Ctrl+V`          | Вставить из системного буфера обмена       |

## Поддержка мыши

- **Одиночный клик**: Установить курсор в позицию клика
- **Двойной клик**: Выделить слово под курсором
- **Тройной клик**: Выделить всю строку
- **Удержание + перемещение**: Выделение текста
- **Колесо прокрутки**: Прокрутка содержимого редактора

**Примечание:** Выделение мышью корректно работает в режиме переноса строк, учитывая перенесённые строки.

## Перенос строк (Word Wrap)

Когда включен режим переноса строк (настраивается в конфигурации), длинные строки автоматически переносятся по ширине панели. Редактор корректно обрабатывает:

- **Позиционирование курсора**: Навигация курсора и его отображение правильно работают на перенесённых строках
- **Выделение мышью**: Клики и перетаскивание точно выделяют текст даже когда строки занимают несколько визуальных рядов
- **Номера строк**: Отображаются для логических строк, а не визуальных рядов
- **Операции редактирования**: Все команды редактирования (вырезать, копировать, вставить, отменить/повторить) работают без проблем с перенесённым содержимым

Включить/выключить перенос строк в конфигурационном файле (`~/.config/termide/config.toml`):
```toml
[editor]
word_wrap = true  # или false
```

## Информация в статусной строке

При работе в редакторе статусная строка отображает:
- Имя файла и признак изменения (*)
- Текущую позицию курсора (строка:столбец)
- Информацию о поиске (количество совпадений)
- Тип файла (обычный текст / только чтение)

## Визуализация Git Diff

При редактировании файлов в git-репозитории с включённым `show_git_diff` редактор отображает информацию об изменениях в реальном времени по сравнению с HEAD:

### Цвета номеров строк

Номера строк окрашены в зависимости от статуса по сравнению с HEAD:

- **Зелёный** - Строка была добавлена (отсутствует в HEAD)
- **Жёлтый** - Строка была изменена (отличается от HEAD)
- **Красный маркер (▶)** - Отмечает точку удаления (после этой строки были удалены строки)
- **Цвет по умолчанию** - Строка не изменена по сравнению с HEAD

### Маркеры удаления

Когда строки удалены, вставляется виртуальная строка для визуализации удаления:

- Отображается горизонтальная линия (`━`), охватывающая ширину редактора
- Показывается символ маркера удаления (`▶`) в области номера строки красным цветом
- Отображается текст по центру: "N строк удалено" (например, "3 строки удалены")
- Стилизовано серым/отключённым цветом для отличия от реального содержимого
- Не влияет на нумерацию строк (показывает `▶` вместо номера)

**Пример:**
```
  42 | function calculateTotal() {
 ▶   | ━━━━━━━ 5 строк удалено ━━━━━━━
  43 |     return result;
```

### Как это работает

- **Автоматические обновления**: Diff обновляется при сохранении файла
- **Сравнение в реальном времени**: Сравнивает текущее содержимое буфера с версией из HEAD
- **Поддержка отмены/повтора**: Маркеры появляются/исчезают при отмене/повторе удалений
- **Работает с редактированием**: Все обычные операции редактирования работают без проблем с визуализацией diff

### Конфигурация

Включить или отключить визуализацию git diff в конфигурационном файле (`~/.config/termide/config.toml`):

```toml
# Показывать цвета git diff на номерах строк (по умолчанию: true)
show_git_diff = true
```

**Примечания:**
- Работает только при редактировании файлов внутри git-репозитория
- Требует наличия файла в HEAD (новые неотслеживаемые файлы показывают все строки как добавленные)
- Виртуальные строки-маркеры удаления только визуальные и не влияют на содержимое файла
